var I=Object.defineProperty;var U=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var D=(n,o,a)=>o in n?I(n,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[o]=a,P=(n,o)=>{for(var a in o||(o={}))j.call(o,a)&&D(n,a,o[a]);if(U)for(var a of U(o))B.call(o,a)&&D(n,a,o[a]);return n};import{P as S}from"./Pagination.094cab9b.js";import{r as c,V as L,b as p,d as r,f as e,H as b,I as g,Q as T,t as h,C as E,o as A,M as N,g as y,h as M,F,e as O}from"./vendor.72820acd.js";import{_ as V}from"./index.fa8506b3.js";import{D as H}from"./DelModal.325ec80c.js";import{a as v}from"./index.40a71972.js";const Q={props:{coupon:{type:Object,default(){return{}}},isNew:{type:Boolean,default:!1}},emits:["update-coupon"],setup(n){const o=c({}),a=c("");return L(()=>n.coupon,t=>{o.value=t;const m=new Date(o.value.due_date*1e3).toISOString().split("T");[a.value]=m}),L(()=>a.value,t=>{o.value.due_date=Math.floor(new Date(t)/1e3)}),{tempCoupon:o,due_date:a}}},q={class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},z={class:"modal-dialog",role:"document"},G={class:"modal-content"},J={class:"modal-header"},K={class:"modal-title",id:"exampleModalLabel"},R={key:0},W={key:1},X=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Y={class:"modal-body"},Z={class:"mb-3"},$=e("label",{for:"title"},"\u6A19\u984C",-1),oo={class:"mb-3"},eo=e("label",{for:"coupon_code"},"\u512A\u60E0\u78BC",-1),to={class:"mb-3"},no=e("label",{for:"due_date"},"\u5230\u671F\u65E5",-1),ao={class:"mb-3"},lo=e("label",{for:"price"},"\u6298\u6263\u767E\u5206\u6BD4",-1),so={class:"mb-3"},io={class:"form-check"},co=e("label",{class:"form-check-label",for:"is_enabled"}," \u662F\u5426\u555F\u7528 ",-1),uo={class:"modal-footer"},po=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"\u53D6\u6D88",-1);function ro(n,o,a,t,m,f){return p(),r("div",q,[e("div",z,[e("div",G,[e("div",J,[e("h5",K,[a.isNew?(p(),r("span",R,"\u65B0\u589E\u512A\u60E0\u5377")):(p(),r("span",W,"\u7DE8\u8F2F\u512A\u60E0\u5377"))]),X]),e("div",Y,[e("div",Z,[$,b(e("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":o[0]||(o[0]=s=>t.tempCoupon.title=s),placeholder:"\u8ACB\u8F38\u5165\u6A19\u984C"},null,512),[[g,t.tempCoupon.title]])]),e("div",oo,[eo,b(e("input",{type:"text",class:"form-control",id:"coupon_code","onUpdate:modelValue":o[1]||(o[1]=s=>t.tempCoupon.code=s),placeholder:"\u8ACB\u8F38\u5165\u512A\u60E0\u78BC"},null,512),[[g,t.tempCoupon.code]])]),e("div",to,[no,b(e("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":o[2]||(o[2]=s=>t.due_date=s)},null,512),[[g,t.due_date]])]),e("div",ao,[lo,b(e("input",{type:"number",class:"form-control",id:"price",min:"0","onUpdate:modelValue":o[3]||(o[3]=s=>t.tempCoupon.percent=s),placeholder:"\u8ACB\u8F38\u5165\u6298\u6263\u767E\u5206\u6BD4"},null,512),[[g,t.tempCoupon.percent,void 0,{number:!0}]])]),e("div",so,[e("div",io,[b(e("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":o[4]||(o[4]=s=>t.tempCoupon.is_enabled=s),id:"is_enabled"},null,512),[[T,t.tempCoupon.is_enabled]]),co])])]),e("div",uo,[po,e("button",{type:"button",class:"btn btn-primary",onClick:o[5]||(o[5]=s=>n.$emit("update-coupon",t.tempCoupon))},h(a.isNew?"\u65B0\u589E\u512A\u60E0\u5377":"\u66F4\u65B0\u512A\u60E0\u5238"),1)])])])],512)}var mo=V(Q,[["render",ro]]);const _o={components:{Pagination:S,CouponModal:mo,DelModal:H},name:"admin-Coupons",setup(){var x;const n=(x=E())==null?void 0:x.appContext.config.globalProperties.$httpMsgState,o=c(!1),a=c(!1),t=c({}),m=c({}),f=c({}),s=c({}),u=c({title:"",is_enabled:0,percent:100,code:""}),C=c(1);A(async()=>{t.value=new N(document.getElementById("couponModal"),{keyboard:!1}),m.value=new N(document.getElementById("delModal"),{keyboard:!1});try{await v.auth.checkAuth(),_()}catch(d){n(d,"\u932F\u8AA4\u8A0A\u606F")}});const _=async(d=1)=>{C.value=d,o.value=!0;try{const i=await v.adminCoupon.getCoupons(d);s.value=i.coupons,f.value=i.pagination,o.value=!1}catch(i){o.value=!1,n(i,"\u932F\u8AA4\u8A0A\u606F")}};return{isLoading:o,isNew:a,getCoupons:_,pagination:f,openCouponModal:(d,i)=>{a.value=d==="new",u.value=d==="new"?{due_date:new Date().getTime()/1e3}:P({},i)},updateCoupon:async()=>{o.value=!0;let d=u.value;if(a.value){try{const i=await v.adminCoupon.updateCoupon(u.value.id,{data:d});_(),o.value=!1,n(i,"\u65B0\u589E\u512A\u60E0\u5238"),t.value.hide()}catch(i){o.value=!1,n(i,"\u932F\u8AA4\u8A0A\u606F")}return}try{d=u.value;const i=await v.adminCoupon.updateCoupon(u.value.id,{data:d});o.value=!1,n(i,"\u7DE8\u8F2F\u512A\u60E0\u5238"),t.value.hide()}catch(i){o.value=!1,n(i,"\u932F\u8AA4\u8A0A\u606F")}},delCoupon:async()=>{try{const d=await v.adminCoupon.delCoupon(u.value.id);o.value=!1,n(d,"\u522A\u9664\u512A\u60E0\u5238"),m.value.hide(),_(C.value)}catch(d){o.value=!1,n(d,"\u522A\u9664\u512A\u60E0\u5238")}},coupons:s,tempCoupon:u}}},bo={class:"container"},vo={class:"row py-1"},fo={class:"col-12 col-sm-12"},Co={class:"text-end mb-3"},go={class:"table table-hover mt-4"},ho=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"\u540D\u7A31"),e("th",{scope:"col"},"\u6298\u6263\u767E\u5206\u6BD4"),e("th",{scope:"col"},"\u5230\u671F\u65E5"),e("th",{scope:"col"},"\u662F\u5426\u555F\u7528"),e("th",{scope:"col"},"\u7DE8\u8F2F")])],-1),yo={key:0,class:"text-success"},Mo={key:1,class:"text-muted"},wo={class:"btn-group"},ko=["onClick"],xo=["onClick"];function Uo(n,o,a,t,m,f){const s=y("Loading"),u=y("Pagination"),C=y("CouponModal"),_=y("DelModal");return p(),r("div",bo,[M(s,{active:t.isLoading,"onUpdate:active":o[0]||(o[0]=l=>t.isLoading=l),"is-full-page":!0},null,8,["active"]),e("div",vo,[e("div",fo,[e("div",Co,[e("button",{type:"button",class:"btn btn-success",onClick:o[1]||(o[1]=l=>t.openCouponModal("new")),"data-bs-toggle":"modal","data-bs-target":"#couponModal"},"\u5EFA\u7ACB\u65B0\u7684\u512A\u60E0\u5238")]),e("table",go,[ho,e("tbody",null,[(p(!0),r(F,null,O(t.coupons,(l,w)=>(p(),r("tr",{key:w},[e("td",null,h(l.title),1),e("td",null,h(l.percent)+"%",1),e("td",null,h(n.$filters.date(l.due_date)),1),e("td",null,[l.is_enabled===1?(p(),r("span",yo,"\u555F\u7528")):(p(),r("span",Mo,"\u672A\u555F\u7528"))]),e("td",null,[e("div",wo,[e("button",{class:"btn btn-outline-primary btn-sm",type:"button","data-bs-target":"#couponModal","data-bs-toggle":"modal",onClick:k=>t.openCouponModal("edit",l)},"\u7DE8\u8F2F",8,ko),e("button",{class:"btn btn-outline-danger btn-sm",type:"button","data-bs-target":"#delModal","data-bs-toggle":"modal",onClick:k=>t.openCouponModal("delete",l)},"\u522A\u9664",8,xo)])])]))),128))])])])]),M(u,{pages:t.pagination,"onUpdate:pages":o[2]||(o[2]=l=>t.pagination=l),onUpdatePages:t.getCoupons},null,8,["pages","onUpdatePages"]),M(C,{coupon:t.tempCoupon,"onUpdate:coupon":o[3]||(o[3]=l=>t.tempCoupon=l),"is-new":t.isNew,"onUpdate:is-new":o[4]||(o[4]=l=>t.isNew=l),ref:"couponModal",onUpdateCoupon:t.updateCoupon},null,8,["coupon","is-new","onUpdateCoupon"]),M(_,{item:t.tempCoupon,"onUpdate:item":o[5]||(o[5]=l=>t.tempCoupon=l),ref:"delModal",onDelItem:t.delCoupon},null,8,["item","onDelItem"])])}var jo=V(_o,[["render",Uo]]);export{jo as default};
