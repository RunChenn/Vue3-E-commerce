var B=Object.defineProperty;var P=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var D=(a,o,n)=>o in a?B(a,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[o]=n,U=(a,o)=>{for(var n in o||(o={}))E.call(o,n)&&D(a,n,o[n]);if(P)for(var n of P(o))I.call(o,n)&&D(a,n,o[n]);return a};import{P as S}from"./Pagination.094cab9b.js";import{D as N}from"./DelModal.325ec80c.js";import{r as u,V as q,b as l,d,f as t,t as r,O as f,F as g,e as C,H as L,Q as $,C as F,o as z,M as j,g as O,h as k,n as A}from"./vendor.72820acd.js";import{_ as V}from"./index.fa8506b3.js";import{a as M}from"./index.40a71972.js";const H={props:{order:{type:Object,default(){return{}}}},emits:["update-paid"],setup(a){const o=u({}),n=u({}),e=u(!1);return q(()=>a.order,()=>{n.value=a.order}),{status:o,tempOrder:n,isPaid:e}}},Q={class:"modal fade",id:"orderModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"orderModal"},G={class:"modal-dialog modal-xl",role:"document"},J={class:"modal-content border-0"},K=t("div",{class:"modal-header bg-dark text-white"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},[t("span",null,"\u8A02\u55AE\u7D30\u7BC0")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),R={class:"modal-body"},T={class:"row"},W={class:"col-md-4"},X=t("h3",null,"\u7528\u6236\u8CC7\u6599",-1),Y={class:"table"},Z={key:0},tt=t("th",{style:{width:"100px"}},"\u59D3\u540D",-1),et=t("th",null,"Email",-1),ot=t("th",null,"\u96FB\u8A71",-1),at=t("th",null,"\u5730\u5740",-1),st={class:"col-md-8"},lt=t("h3",null,"\u8A02\u55AE\u7D30\u7BC0",-1),dt={class:"table"},nt=t("th",{style:{width:"100px"}},"\u8A02\u55AE\u7DE8\u865F",-1),rt=t("th",null,"\u4E0B\u55AE\u6642\u9593",-1),it=t("th",null,"\u4ED8\u6B3E\u6642\u9593",-1),ct={key:0},ut={key:1},_t=t("th",null,"\u4ED8\u6B3E\u72C0\u614B",-1),pt={key:0,class:"text-success"},ht={key:1,class:"text-muted"},mt=t("th",null,"\u7E3D\u91D1\u984D",-1),bt=t("h3",null,"\u9078\u8CFC\u5546\u54C1",-1),ft={class:"table"},vt=t("thead",null,[t("tr")],-1),yt={class:"text-end"},gt={class:"d-flex justify-content-end"},Ot={class:"form-check"},kt={class:"form-check-label",for:"flexCheckDefault"},Mt={key:0},xt={key:1},Ct={class:"modal-footer"},wt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"\u53D6\u6D88",-1);function Pt(a,o,n,e,v,x){return l(),d("div",Q,[t("div",G,[t("div",J,[K,t("div",R,[t("div",T,[t("div",W,[X,t("table",Y,[e.tempOrder.user?(l(),d("tbody",Z,[t("tr",null,[tt,t("td",null,r(e.tempOrder.user.name),1)]),t("tr",null,[et,t("td",null,r(e.tempOrder.user.email),1)]),t("tr",null,[ot,t("td",null,r(e.tempOrder.user.tel),1)]),t("tr",null,[at,t("td",null,r(e.tempOrder.user.address),1)])])):f("v-if",!0)])]),t("div",st,[lt,t("table",dt,[t("tbody",null,[t("tr",null,[nt,t("td",null,r(e.tempOrder.id),1)]),t("tr",null,[rt,t("td",null,r(a.$filters.date(e.tempOrder.create_at)),1)]),t("tr",null,[it,t("td",null,[e.tempOrder.paid_date?(l(),d("span",ct,r(a.$filters.date(e.tempOrder.paid_date)),1)):(l(),d("span",ut,"\u6642\u9593\u4E0D\u6B63\u78BA"))])]),t("tr",null,[_t,t("td",null,[e.tempOrder.is_paid?(l(),d("strong",pt,"\u5DF2\u4ED8\u6B3E")):(l(),d("span",ht,"\u5C1A\u672A\u4ED8\u6B3E"))])]),t("tr",null,[mt,t("td",null,r(a.$filters.currency(e.tempOrder.total)),1)])])]),bt,t("table",ft,[vt,t("tbody",null,[(l(!0),d(g,null,C(e.tempOrder.products,i=>(l(),d("tr",{key:i.id},[t("th",null,r(i.product.title),1),t("td",null,r(i.qty)+" / "+r(i.product.unit),1),t("td",yt,r(a.$filters.currency(i.final_total)),1)]))),128))])]),t("div",gt,[t("div",Ot,[L(t("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":o[0]||(o[0]=i=>e.tempOrder.is_paid=i)},null,512),[[$,e.tempOrder.is_paid]]),t("label",kt,[e.tempOrder.is_paid?(l(),d("span",Mt,"\u5DF2\u4ED8\u6B3E")):(l(),d("span",xt,"\u672A\u4ED8\u6B3E"))])])])])])]),t("div",Ct,[wt,t("button",{type:"button",class:"btn btn-primary",onClick:o[1]||(o[1]=i=>a.$emit("update-paid",e.tempOrder))},"\u4FEE\u6539\u4ED8\u6B3E\u72C0\u614B")])])])],512)}var Dt=V(H,[["render",Pt]]);const Ut={components:{Pagination:S,OrderModal:Dt,DelModal:N},name:"admin-Orders",setup(){var y;const a=(y=F())==null?void 0:y.appContext.config.globalProperties.$httpMsgState,o=u(!1),n=u({}),e=u({}),v=u({}),x=u(!1),i=u({}),m=u({}),b=u(1);z(async()=>{n.value=new j(document.getElementById("orderModal"),{keyboard:!1}),e.value=new j(document.getElementById("delModal"),{keyboard:!1});try{await M.auth.checkAuth(),h()}catch(c){a(c,"\u932F\u8AA4\u8A0A\u606F")}});const h=async(c=1)=>{b.value=c,o.value=!0;try{const p=await M.adminOrder.getOrders(c);v.value=p.orders,i.value=p.pagination,o.value=!1}catch(p){o.value=!1,a(p,"\u932F\u8AA4\u8A0A\u606F")}};return{orders:v,tempOrder:m,isLoading:o,getOrders:h,pagination:i,openModal:c=>{x.value=!1,m.value=U({},c)},updatePaid:async c=>{o.value=!0;try{const p=await M.adminOrder.updateOrders(c.id,{data:{is_paid:c.is_paid}});o.value=!1,a(p,"\u66F4\u65B0\u4ED8\u6B3E\u72C0\u614B"),n.value.hide(),h(b.value)}catch(p){o.value=!1,a(p,"\u932F\u8AA4\u8A0A\u606F")}},delOrder:async()=>{try{const c=await M.adminOrder.delOrder(m.value.id);o.value=!1,a(c,"\u522A\u9664\u8A02\u55AE"),e.value.hide(),h(b.value)}catch(c){o.value=!1,a(c,"\u932F\u8AA4\u8A0A\u606F")}}}}},Lt={class:"container"},$t={class:"row py-1"},jt={class:"col-12 col-sm-12"},Vt={class:"table table-hover mt-4"},Bt=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"\u8CFC\u8CB7\u6642\u9593"),t("th",{scope:"col"},"Email"),t("th",{scope:"col"},"\u8CFC\u8CB7\u6B3E\u9805"),t("th",{scope:"col"},"\u61C9\u4ED8\u91D1\u984D"),t("th",{scope:"col"},"\u662F\u5426\u4ED8\u6B3E"),t("th",{scope:"col"},"\u64CD\u4F5C")])],-1),Et=["textContent"],It={class:"list-unstyled"},St={class:"text-right"},Nt={class:"form-check form-switch"},qt=["id","onUpdate:modelValue","onChange"],Ft=["for"],zt={key:0},At={key:1},Ht={class:"btn-group"},Qt=["onClick"],Gt=["onClick"];function Jt(a,o,n,e,v,x){const i=O("Loading"),m=O("Pagination"),b=O("OrderModal"),h=O("DelModal");return l(),d("div",Lt,[k(i,{active:e.isLoading,"onUpdate:active":o[0]||(o[0]=s=>e.isLoading=s),"is-full-page":!0},null,8,["active"]),t("div",$t,[t("div",jt,[t("table",Vt,[Bt,t("tbody",null,[(l(!0),d(g,null,C(e.orders,(s,w)=>(l(),d(g,{key:w},[e.orders.length?(l(),d("tr",{key:0,class:A({"text-primary":!s.is_paid})},[t("td",null,r(a.$filters.date(s.create_at)),1),t("td",null,[s.user?(l(),d("span",{key:0,textContent:r(s.user.email)},null,8,Et)):f("v-if",!0)]),t("td",null,[t("ul",It,[(l(!0),d(g,null,C(s.products,(_,y)=>(l(),d("li",{key:y},r(_.product.title)+" \u6578\u91CF\uFF1A"+r(_.qty)+" "+r(_.product.unit),1))),128))])]),t("td",St,r(s.total),1),t("td",null,[t("div",Nt,[L(t("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${s.id}`,"onUpdate:modelValue":_=>s.is_paid=_,onChange:_=>e.updatePaid(s)},null,40,qt),[[$,s.is_paid]]),t("label",{class:"form-check-label",for:`paidSwitch${s.id}`},[s.is_paid?(l(),d("span",zt,"\u5DF2\u4ED8\u6B3E")):(l(),d("span",At,"\u672A\u4ED8\u6B3E"))],8,Ft)])]),t("td",null,[t("div",Ht,[t("button",{class:"btn btn-outline-primary btn-sm",type:"button","data-bs-target":"#orderModal","data-bs-toggle":"modal",onClick:_=>e.openModal(s)},"\u6AA2\u8996",8,Qt),t("button",{class:"btn btn-outline-danger btn-sm",type:"button","data-bs-target":"#delModal","data-bs-toggle":"modal",onClick:_=>e.openModal(s)},"\u522A\u9664",8,Gt)])])],2)):f("v-if",!0)],64))),128))])])])]),k(m,{pages:e.pagination,"onUpdate:pages":o[1]||(o[1]=s=>e.pagination=s),onUpdatePages:e.getOrders},null,8,["pages","onUpdatePages"]),f(" Modal "),k(b,{order:e.tempOrder,"onUpdate:order":o[2]||(o[2]=s=>e.tempOrder=s),ref:"orderModal",onUpdatePaid:e.updatePaid},null,8,["order","onUpdatePaid"]),f(" delModal "),k(h,{ref:"delModal",item:e.tempOrder,"onUpdate:item":o[3]||(o[3]=s=>e.tempOrder=s),onDelItem:e.delOrder},null,8,["item","onDelItem"])])}var Zt=V(Ut,[["render",Jt]]);export{Zt as default};
