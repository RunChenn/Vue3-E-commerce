import{C as A,r as m,X as j,o as M,g as u,b as i,d as _,O as w,h,f as o,H as L,I as N,t as I,Y as P,J as T,R as U,T as V,K as x}from"./vendor.72820acd.js";import{a as p}from"./index.40a71972.js";import{_ as B,e as b}from"./index.fa8506b3.js";import{C as H,F}from"./Form.8007c743.js";import{R as q}from"./RelatedProds.1977b4f4.js";const D={components:{Carts:H,Form:F,RelatedProds:q},name:"Products",setup(){var S;const s=(S=A())==null?void 0:S.appContext.config.globalProperties.$httpMsgState,e=m(!1),C=m({}),t=m(""),r=j({loadingItem:""}),f=m(!1),y=m(0),g=m("");M(()=>{e.value=!0,c(),b.emit("get-cart")});const c=async()=>{try{const a=await p.cart.getCart();C.value=a.data,e.value=!1}catch(a){e.value=!1,s(a,"\u932F\u8AA4\u8A0A\u606F")}};return{isLoading:e,cart:C,loadingStatus:r,getCart:c,addToCart:async(a,d=1)=>{productModal.value.hide();try{r.loadingItem=a;const v={product_id:a,qty:d},R=await p.cart.addCart({data:v});s(R,"\u52A0\u5165\u8CFC\u7269\u8ECA"),r.loadingItem="",c(),b.emit("get-cart")}catch(v){s(v,"\u52A0\u5165\u8CFC\u7269\u8ECA")}},removeCartItem:async a=>{try{const d=await p.cart.removeCartItem(a);r.loadingItem=a,s(d,"\u79FB\u9664\u8CFC\u7269\u8ECA\u54C1\u9805"),r.loadingItem="",c(),b.emit("get-cart")}catch(d){s(d,"\u79FB\u9664\u8CFC\u7269\u8ECA\u54C1\u9805")}},removeCartAll:async()=>{try{const a=await p.cart.removeCartAll();s(a,"\u6E05\u9664\u8CFC\u7269\u8ECA"),c(),b.emit("get-cart")}catch(a){s(a,"\u6E05\u9664\u8CFC\u7269\u8ECA")}},updateCart:async a=>{try{r.loadingItem=a.id;const d={product_id:a.product_id,qty:a.qty},v=await p.cart.updateCart(a.product_id,{data:d});s(v,"\u66F4\u65B0\u8CFC\u7269\u8ECA"),r.loadingItem="",c(),b.emit("get-cart")}catch(d){r.loadingItem="",s(d,"\u66F4\u65B0\u8CFC\u7269\u8ECA")}},codeText:t,addConpon:async()=>{try{r.loadingItem=t.value!=="";const a={code:t.value},d=await p.coupon.addConpon({data:a});f.value=!0,t.value="",g.value=d.message.split(":")[1],s(d,"\u52A0\u5165\u512A\u60E0\u5238"),r.loadingItem="",c(),b.emit("get-cart")}catch(a){r.loadingItem="",s(a,"\u52A0\u5165\u512A\u60E0\u5238")}},isHaveCoupon:f,couponTotal:y,codeMsg:g}}},l=s=>(U("data-v-77ef69c4"),s=s(),V(),s),E={class:"container pt-4"},J={class:"mt-3"},K=l(()=>o("h3",{class:"mt-3 mb-4"},[o("i",{class:"fas fa-shopping-cart"}),x("\xA0\u8CFC\u7269\u8ECA")],-1)),O={key:0,class:"row"},X={class:"col-md-8"},Y={class:"row justify-content-between"},z={class:"col-auto"},G=["disabled"],Q={class:"col-auto"},W={class:"input-group w-100 mb-3"},Z={class:"input-group-append"},$=["disabled"],tt={key:0,class:"fas fa-spinner fa-pulse"},ot={key:1,class:"fas fa-paper-plane"},at={class:"col-md-4"},et={class:"border p-4 mb-4"},st=l(()=>o("h4",{class:"fw-bold mb-4"},"\u8A02\u55AE\u8CC7\u8A0A",-1)),rt={class:"table text-muted border-bottom"},nt=l(()=>o("th",{scope:"row",class:"border-0 px-0 pt-4 font-weight-normal"},"\u5C0F\u8A08",-1)),dt={class:"text-end border-0 px-0 pt-4"},ct={key:0},it=l(()=>o("th",{scope:"row",class:"border-0 px-0 pt-0 pb-4 font-weight-normal"},"\u512A\u60E0\u5238",-1)),lt={class:"text-end border-0 px-0 pt-0 pb-4"},mt={class:"d-flex justify-content-between mt-4"},_t=l(()=>o("p",{class:"mb-0 h4 fw-bold"},"\u7E3D\u91D1\u984D",-1)),pt={class:"mb-0 h4 fw-bold"},bt=x("\u524D\u5F80\u7D50\u5E33"),vt={key:1,class:"row"},gt={class:"border p-4 mb-4"},ut=l(()=>o("h4",{class:"fw-bold mt-3 mb-4"},"\u8CFC\u7269\u8ECA\u76EE\u524D\u6C92\u6709\u5546\u54C1",-1)),ht=x("\u7E7C\u7E8C\u8CFC\u7269"),Ct={class:"my-5"},ft=l(()=>o("h3",{class:"fw-bold"},"\u76F8\u95DC\u7522\u54C1",-1));function yt(s,e,C,t,r,f){const y=u("Loading"),g=u("Carts"),c=u("router-link"),k=u("RelatedProds");return i(),_("div",E,[w(" Loading "),h(y,{active:t.isLoading,"onUpdate:active":e[0]||(e[0]=n=>t.isLoading=n),"is-full-page":!0},null,8,["active"]),o("div",J,[K,t.cart.carts&&t.cart.carts.length!==0?(i(),_("div",O,[o("div",X,[h(g,{cart:t.cart,"onUpdate:cart":e[1]||(e[1]=n=>t.cart=n),loadingStatus:t.loadingStatus,"onUpdate:loadingStatus":e[2]||(e[2]=n=>t.loadingStatus=n),onRemoveCartItem:t.removeCartItem,onRemoveCartAll:t.removeCartAll,onUpdateCart:t.updateCart},null,8,["cart","loadingStatus","onRemoveCartItem","onRemoveCartAll","onUpdateCart"]),o("div",Y,[o("div",z,[o("button",{class:"btn btn-outline-primary",type:"button",onClick:e[3]||(e[3]=(...n)=>t.removeCartAll&&t.removeCartAll(...n)),disabled:t.cart.carts&&t.cart.carts.length===0},"\u6E05\u7A7A\u8CFC\u7269\u8ECA",8,G)]),o("div",Q,[o("div",W,[L(o("input",{type:"text",class:"form-control rounded-0 border-bottom border-top-0 border-start-0 border-end-0 shadow-none",placeholder:"\u8F38\u5165\u512A\u60E0\u5238","aria-label":"Recipient's username","aria-describedby":"button-addon2","onUpdate:modelValue":e[4]||(e[4]=n=>t.codeText=n)},null,512),[[N,t.codeText]]),o("div",Z,[o("button",{class:"btn btn-outline-dark border-bottom border-top-0 border-start-0 border-end-0 rounded-0",type:"button",id:"button-addon2",disabled:t.loadingStatus.loadingItem===(t.codeText!=="")||t.codeText==="",onClick:e[5]||(e[5]=(...n)=>t.addConpon&&t.addConpon(...n))},[t.loadingStatus.loadingItem===t.isHaveCoupon?(i(),_("i",tt)):(i(),_("i",ot))],8,$)])])])])]),o("div",at,[o("div",et,[st,o("table",rt,[o("tbody",null,[o("tr",null,[nt,o("td",dt,"NT$"+I(t.cart.total),1)]),t.isHaveCoupon?(i(),_("tr",ct,[it,o("td",lt,I(t.codeMsg),1)])):w("v-if",!0)])]),o("div",mt,[_t,o("p",pt,"NT$"+I(t.cart.final_total),1)]),t.cart.carts&&t.cart.carts.length!==0?(i(),P(c,{key:0,class:"btn btn-dark w-100 mt-4",to:"/checkout"},{default:T(()=>[bt]),_:1})):w("v-if",!0)])])])):(i(),_("div",vt,[o("div",gt,[ut,h(c,{class:"btn btn-primary",to:"/products"},{default:T(()=>[ht]),_:1})])])),o("div",Ct,[ft,h(k)])])])}var jt=B(D,[["render",yt],["__scopeId","data-v-77ef69c4"]]);export{jt as default};
