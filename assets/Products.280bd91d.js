var j=Object.defineProperty;var C=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var D=(l,e,o)=>e in l?j(l,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[e]=o,V=(l,e)=>{for(var o in e||(e={}))q.call(e,o)&&D(l,o,e[o]);if(C)for(var o of C(e))A.call(e,o)&&D(l,o,e[o]);return l};import{P as E}from"./Pagination.094cab9b.js";import{C as S,r as p,o as L,M as x,b as r,d as c,f as t,O as M,F as N,e as B,H as g,I as f,Q as z,R as O,T,g as k,h as U,t as w,U as H}from"./vendor.72820acd.js";import{a as v}from"./index.40a71972.js";import{_ as F}from"./index.fa8506b3.js";import{D as Q}from"./DelModal.325ec80c.js";const R={props:{isNew:{type:Boolean,default:!1},product:{type:Object,default:()=>({imagesUrl:{type:Array,default:()=>[]},id:{type:String,default:""}})}},setup(l){var a;const e=(a=S())==null?void 0:a.appContext.config.globalProperties.$httpMsgState;let o=p(null);L(async()=>{o.value=new x(document.getElementById("adminProductModal"),{keyboard:!1})});const s=p(null),b=p(null);return{oneFileInput:s,fileInput:b,upload:async m=>{if(m==="oneImage"){const i=s.value.files[0],_=new FormData;_.append("file-to-upload",i);try{const d=await v.adminProducts.uploadImg(_),{imageUrl:h}=d;l.product.imageUrl=h}catch(d){e(d,"\u932F\u8AA4\u8A0A\u606F")}return}l.product.imagesUrl=[];for(let i=0;i<b.value.files.length;i++){const _=new FormData;_.append("file-to-upload",b.value.files[i]);try{const d=await v.adminProducts.uploadImg(_),{imageUrl:h}=d;l.product.imagesUrl.push(h)}catch(d){e(d,"\u932F\u8AA4\u8A0A\u606F")}}}}}},u=l=>(O("data-v-3e686dd6"),l=l(),T(),l),G={id:"adminProductModal",ref:"adminProductModal",class:"modal fade text-start",tabindex:"-1","aria-labelledby":"adminProductModalLabel","aria-hidden":"true","data-bs-backdrop":"static","data-bs-keyboard":"false"},J={class:"modal-dialog modal-dialog-scrollable modal-xl"},K={class:"modal-content border-0"},W={class:"modal-header bg-primary text-white"},X={id:"adminProductModalLabel",class:"modal-title"},Y={key:0},Z={key:1},$=u(()=>t("button",{type:"button",class:"btn-close text-white","data-bs-dismiss":"modal","aria-label":"Close"},null,-1)),tt={class:"modal-body"},et={class:"row needs-validation",novalidate:""},ot={class:"col-sm-4"},at={class:"mb-3"},lt=u(()=>t("label",{for:"imageUrl",class:"form-label"},"\u4E3B\u8981\u5716\u7247",-1)),st={class:"mb-3"},dt=["src"],nt=u(()=>t("h3",{class:"mb-3"},"\u591A\u5716\u65B0\u589E",-1)),it={class:"mb-3"},rt={key:0},ct=["src"],ut={key:1},mt={class:"col-sm-8"},pt={class:"mb-3"},bt=u(()=>t("label",{for:"title",class:"form-label"},"\u6A19\u984C",-1)),_t={class:"row"},gt={class:"mb-3 col-md-6"},ft=u(()=>t("label",{for:"category",class:"form-label"},"\u5206\u985E",-1)),vt={class:"mb-3 col-md-6"},ht=u(()=>t("label",{for:"price",class:"form-label"},"\u55AE\u4F4D",-1)),yt={class:"row"},Pt={class:"mb-3 col-md-6"},Mt=u(()=>t("label",{for:"origin_price",class:"form-label"},"\u539F\u50F9",-1)),kt={class:"mb-3 col-md-6"},Ut=u(()=>t("label",{for:"price",class:"form-label"},"\u552E\u50F9",-1)),wt=u(()=>t("hr",null,null,-1)),xt={class:"mb-3"},It=u(()=>t("label",{for:"description",class:"form-label"},"\u7522\u54C1\u63CF\u8FF0",-1)),Ct={class:"mb-3"},Dt=u(()=>t("label",{for:"content",class:"form-label"},"\u8AAA\u660E\u5167\u5BB9",-1)),Vt={class:"mb-3"},St={class:"form-check"},Lt=u(()=>t("label",{class:"form-check-label",for:"is_enabled"},"\u662F\u5426\u555F\u7528",-1)),Nt={class:"modal-footer"},Bt=u(()=>t("button",{type:"button",class:"btn btn-outline-danger","data-bs-dismiss":"modal"},"\u53D6\u6D88",-1));function Ft(l,e,o,s,b,P){return r(),c("div",G,[t("div",J,[t("div",K,[t("div",W,[t("h5",X,[o.isNew?(r(),c("span",Y,"\u65B0\u589E\u7522\u54C1")):(r(),c("span",Z,"\u7DE8\u8F2F\u7522\u54C1"))]),$]),t("div",tt,[t("form",et,[t("div",ot,[t("div",at,[lt,t("div",st,[t("input",{class:"form-control",type:"file",id:"oneFileInput",ref:"oneFileInput",onChange:e[0]||(e[0]=a=>s.upload("oneImage"))},null,544)]),o.product.imageUrl?(r(),c("img",{key:0,class:"img-fluid",src:o.product.imageUrl,alt:"product-img"},null,8,dt)):M("v-if",!0)]),nt,t("div",it,[t("input",{class:"form-control",type:"file",id:"fileInput",ref:"fileInput",multiple:"",onChange:e[1]||(e[1]=a=>s.upload("multipleImage"))},null,544)]),Array.isArray(o.product.imagesUrl)?(r(),c("div",rt,[(r(!0),c(N,null,B(o.product.imagesUrl,a=>(r(),c("div",{class:"mb-1",key:`${a}index`},[t("img",{class:"img-fluid",src:a,alt:"product-img"},null,8,ct)]))),128))])):(r(),c("div",ut,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[2]||(e[2]=(...a)=>l.createImages&&l.createImages(...a))},"\u65B0\u589E\u5716\u7247")]))]),t("div",mt,[t("div",pt,[bt,g(t("input",{id:"title","onUpdate:modelValue":e[3]||(e[3]=a=>o.product.title=a),type:"text",class:"form-control",placeholder:"\u8ACB\u8F38\u5165\u6A19\u984C",required:""},null,512),[[f,o.product.title]])]),t("div",_t,[t("div",gt,[ft,g(t("input",{id:"category","onUpdate:modelValue":e[4]||(e[4]=a=>o.product.category=a),type:"text",class:"form-control",placeholder:"\u8ACB\u8F38\u5165\u5206\u985E",required:""},null,512),[[f,o.product.category]])]),t("div",vt,[ht,g(t("input",{id:"unit","onUpdate:modelValue":e[5]||(e[5]=a=>o.product.unit=a),type:"text",class:"form-control",placeholder:"\u8ACB\u8F38\u5165\u55AE\u4F4D"},null,512),[[f,o.product.unit]])])]),t("div",yt,[t("div",Pt,[Mt,g(t("input",{id:"origin_price","onUpdate:modelValue":e[6]||(e[6]=a=>o.product.origin_price=a),type:"number",min:"0",class:"form-control",placeholder:"\u8ACB\u8F38\u5165\u539F\u50F9",required:""},null,512),[[f,o.product.origin_price,void 0,{number:!0}]])]),t("div",kt,[Ut,g(t("input",{id:"price","onUpdate:modelValue":e[7]||(e[7]=a=>o.product.price=a),type:"number",min:"0",class:"form-control",placeholder:"\u8ACB\u8F38\u5165\u552E\u50F9",required:""},null,512),[[f,o.product.price,void 0,{number:!0}]])]),M(` <div class="mb-3">
                  <label for="price" class="form-label">\u5EAB\u5B58\u6578\u91CF</label>
                  <input id="price" v-model.number="product.inventory" type="number" min="0" class="form-control" placeholder="\u8ACB\u8F38\u5165\u5EAB\u5B58\u6578\u91CF" required />
                </div> `)]),wt,t("div",xt,[It,g(t("textarea",{id:"description","onUpdate:modelValue":e[8]||(e[8]=a=>o.product.description=a),type:"text",class:"form-control",placeholder:"\u8ACB\u8F38\u5165\u7522\u54C1\u63CF\u8FF0"}," ",512),[[f,o.product.description]])]),t("div",Ct,[Dt,g(t("textarea",{id:"description","onUpdate:modelValue":e[9]||(e[9]=a=>o.product.content=a),type:"text",class:"form-control",placeholder:"\u8ACB\u8F38\u5165\u8AAA\u660E\u5167\u5BB9"}," ",512),[[f,o.product.content]])]),t("div",Vt,[t("div",St,[g(t("input",{id:"is_enabled","onUpdate:modelValue":e[10]||(e[10]=a=>o.product.is_enabled=a),class:"form-check-input",type:"checkbox","true-value":1,"false-value":0},null,512),[[z,o.product.is_enabled]]),Lt])])])])]),t("div",Nt,[Bt,t("button",{type:"button",class:"btn btn-success",onClick:e[11]||(e[11]=a=>l.$emit("update-product",o.product))},"\u78BA\u8A8D")])])])],512)}var jt=F(R,[["render",Ft],["__scopeId","data-v-3e686dd6"]]);const qt={components:{Pagination:E,ProdModal:jt,DelModal:Q},name:"admin-Products",props:["token"],setup(){var I;const l=(I=S())==null?void 0:I.appContext.config.globalProperties.$httpMsgState,e=p(!1),o=p([]),s=p({}),b=p({}),P=p({}),a=p(!1),m=p({imagesUrl:[],id:""});L(async()=>{s.value=new x(document.getElementById("adminProductModal"),{keyboard:!1}),b.value=new x(document.getElementById("delModal"),{keyboard:!1});try{await v.auth.checkAuth(),i()}catch(n){l(n,"\u932F\u8AA4\u8A0A\u606F")}});const i=async(n=1)=>{e.value=!0;try{const y=await v.adminProducts.getProducts(n);o.value=y.products,P.value=y.pagination,e.value=!1}catch(y){e.value=!1,l(y,"\u932F\u8AA4\u8A0A\u606F")}};return{isLoading:e,products:o,product:m,pagination:P,isNew:a,getData:i,openModal:(n,y)=>{a.value=n==="new",m.value=n==="new"?{imagesUrl:[]}:V({},y)},createImages:()=>{m.value.imagesUrl=[],m.value.imagesUrl.push("")},updateProduct:async()=>{if(a.value){try{const n=await v.adminProducts.addProducts({data:m.value});l(n,"\u65B0\u589E\u5546\u54C1"),s.value.hide(),i()}catch(n){s.value.hide(),l(n,"\u65B0\u589E\u5931\u6557")}return}try{const n=await v.adminProducts.updateProducts(m.value.id,{data:m.value});l(n,"\u7DE8\u8F2F\u5546\u54C1"),s.value.hide(),i()}catch(n){s.value.hide(),l(n,"\u932F\u8AA4\u8A0A\u606F")}},delProduct:async()=>{e.value=!0;try{const n=await v.adminProducts.delProducts(m.value.id);e.value=!1,l(n,"\u522A\u9664\u5546\u54C1"),b.value.hide(),i()}catch(n){e.value=!1,b.value.hide(),l(n,"\u932F\u8AA4\u8A0A\u606F")}}}}},At={class:"container"},Et={class:"row py-1"},zt={class:"col-12 col-sm-12"},Ot={class:"text-end mb-3"},Tt={class:"table table-hover mt-4"},Ht=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"\u5206\u985E"),t("th",{scope:"col"},"\u5716\u7247"),t("th",{scope:"col",class:"text-start"},"\u7522\u54C1\u540D\u7A31"),t("th",{scope:"col"},"\u539F\u50F9"),t("th",{scope:"col"},"\u552E\u50F9"),t("th",{scope:"col"},"\u662F\u5426\u555F\u7528"),t("th",{scope:"col"},"\u64CD\u4F5C")])],-1),Qt={style:{width:"200px"}},Rt={class:"text-end"},Gt={class:"text-end"},Jt={key:0,class:"text-success"},Kt={key:1},Wt=["onClick"],Xt=["onClick"];function Yt(l,e,o,s,b,P){const a=k("Loading"),m=k("Pagination"),i=k("ProdModal"),_=k("DelModal");return r(),c("div",At,[M(" Loading "),U(a,{active:s.isLoading,"onUpdate:active":e[0]||(e[0]=d=>s.isLoading=d),"is-full-page":!0},null,8,["active"]),t("div",Et,[t("div",zt,[t("div",Ot,[t("button",{type:"button",class:"btn btn-success",onClick:e[1]||(e[1]=d=>s.openModal("new")),"data-bs-toggle":"modal","data-bs-target":"#adminProductModal"},"\u5EFA\u7ACB\u65B0\u7684\u7522\u54C1")]),t("table",Tt,[Ht,t("tbody",null,[(r(!0),c(N,null,B(s.products,d=>(r(),c("tr",{key:d.id},[t("td",null,w(d.category),1),t("td",Qt,[t("div",{style:H([{height:"100px","background-size":"cover","background-position":"center"},{backgroundImage:`url(${d.imageUrl})`}])},null,4)]),t("td",null,w(d.title),1),t("td",Rt,w(d.origin_price),1),t("td",Gt,w(d.price),1),t("td",null,[d.is_enabled?(r(),c("span",Jt,"\u555F\u7528")):(r(),c("span",Kt,"\u672A\u555F\u7528"))]),t("td",null,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm me-2 mb-md-1","data-bs-target":"#adminProductModal","data-bs-toggle":"modal",onClick:h=>s.openModal("edit",d)},"\u7DE8\u8F2F",8,Wt),t("button",{type:"button",class:"btn btn-outline-danger btn-sm me-2 mb-md-1","data-bs-target":"#delModal","data-bs-toggle":"modal",onClick:h=>s.openModal("delete",d)},"\u522A\u9664",8,Xt)])]))),128))])])])]),U(m,{pages:s.pagination,"onUpdate:pages":e[2]||(e[2]=d=>s.pagination=d),onUpdatePages:s.getData},null,8,["pages","onUpdatePages"]),M(" Modal "),U(i,{product:s.product,"onUpdate:product":e[3]||(e[3]=d=>s.product=d),"is-new":s.isNew,"onUpdate:is-new":e[4]||(e[4]=d=>s.isNew=d),onUpdateProduct:s.updateProduct},null,8,["product","is-new","onUpdateProduct"]),M(" delModal "),U(_,{ref:"delModal",item:s.product,"onUpdate:item":e[5]||(e[5]=d=>s.product=d),onDelItem:s.delProduct},null,8,["item","onDelItem"])])}var se=F(qt,[["render",Yt]]);export{se as default};
